/*
 * Created on 12 janv. 2005
 * by binou
 * Copyright: GPL - UMLV(FR) - 2004/2005
 */
package fr.umlv.ir3.flexitime.richClient.gui.panel.exploitation;

import java.awt.Color;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Point;

import java.awt.event.MouseEvent;


import javax.swing.BorderFactory;
import javax.swing.JLabel;
import javax.swing.SwingUtilities;
import javax.swing.event.MouseInputAdapter;





/**
 * DOCME Description
 * explication supplémentaire si nécessaire
 * in english please...
 * Que fait cette classe, qu'est-ce qu'elle 
 * représente, ...
 * 
 * @version Verion ou révision SVN
 * 
 * @author FlexiTeam - binou
 */
public class JLesson extends JLabel
{
	LessonBloc lesson = null;
    
    boolean isSelected = false;
    
    
    
    
    //**********************
    //	Constructeurs
    //**********************
    /**
     * DOCME
     */
    public JLesson()
    {
        this.lesson = null;
        
		MouseEventForwarder forwarder = new MouseEventForwarder();
		addMouseListener(forwarder);
		addMouseMotionListener(forwarder);
        
        this.setOpaque(true);
        this.setText("");
        this.setBackground(Color.WHITE);
        this.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
        this.setPreferredSize(new Dimension(FlexiPlanning.WEEK_WIDTH,FlexiPlanning.GAP_HEIGTH*1));
    }
    
    
    /**
     * DOCME
     * @param lesson
     */
    public JLesson(LessonBloc lesson)
    {
        this.lesson = lesson;

        MouseEventForwarder forwarder = new MouseEventForwarder();
        addMouseListener(forwarder);
        addMouseMotionListener(forwarder);

        this.setOpaque(true);
        this.setBackground(lesson.getLesson().getCourse().getColor());
        this.setBorder(BorderFactory.createLineBorder(Color.BLACK));
        this.setFont(new Font("Serif", Font.PLAIN, 9));
        this.setText("<html>" + lesson.getLesson().getCourse().getName() + " "
                + lesson.getLesson().getGap().getStartDate().getTime() + "/"
                + lesson.getLesson().getGap().getEndDate().getTime() + "</html>");
        this.setToolTipText("<html>" + lesson.getLesson().getCourse().getName() + "<br>"
                + lesson.getLesson().getGap().getStartDate().getTime() + "/"
                + lesson.getLesson().getGap().getEndDate().getTime()
                + "<br> blablabla </html>");
        this.setPreferredSize(new Dimension(FlexiPlanning.WEEK_WIDTH,
                FlexiPlanning.GAP_HEIGTH * lesson.getNbGap()));
    }

    
    
    /** 
     * DOCME Description
     * Quel service est rendu par cette méthode
     * <code>exemple d'appel de la methode</code>
     *
     * @return 
     * 
     * @see (si nécessaire)
     */
    //**********************
    //	Selection
    //**********************
    public boolean isSelected()
    { return isSelected;}
    
    /** 
     * DOCME Description
     * Quel service est rendu par cette méthode
     * <code>exemple d'appel de la methode</code>
     *
     * @param value 
     * 
     */
    public void setSelected(boolean value)
    {
        this.isSelected=value;
        if(value)
        {
            this.setBorder(BorderFactory.createLineBorder(Color.RED));
        }
        else
        {
            if(lesson == null)
                this.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
            else
                this.setBorder(BorderFactory.createLineBorder(Color.BLACK));
        }
    }
    
    /** 
     * DOCME Description
     * Quel service est rendu par cette méthode
     * <code>exemple d'appel de la methode</code>
     *
     * @param b 
     * 
     * @author   FlexiTeam - binou
     */
    public void setDragOver(boolean b)
    {
        //System.out.println("drag = " + b);
        if(b == true)
            this.setBackground(Color.GREEN);
        else
            this.setBackground(Color.WHITE);
    }
    
    
    

  
  
    //**********************
    //	getters
    //**********************
	public LessonBloc getLesson() {
		return lesson;
	}
	
	public int getNbGaps()
	{
		if(lesson == null)
			return 1;
        
		return lesson.getNbGap();
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	final class MouseEventForwarder extends MouseInputAdapter {
		public void mousePressed(MouseEvent e) {
	    	
	    	//forward
			Container parent = getParent();
			if (parent != null) {
				Point newPoint = SwingUtilities.convertPoint(JLesson.this, e.getPoint(), parent);
				e.translatePoint(newPoint.x-e.getX(), newPoint.y-e.getY());
				e.setSource(parent);
				parent.dispatchEvent(e);
			}
		}

		public void mouseReleased(MouseEvent e) {
			Container parent = getParent();
			if (parent != null) {
				Point newPoint = SwingUtilities.convertPoint(JLesson.this, e.getPoint(), parent);
				e.translatePoint(newPoint.x-e.getX(), newPoint.y-e.getY());
				e.setSource(parent);
				parent.dispatchEvent(e);			
			}
		}

		public void mouseDragged(MouseEvent e) {
			Container parent = getParent();
			if (parent != null) {
				Point newPoint = SwingUtilities.convertPoint(JLesson.this, e.getPoint(), parent);
				e.translatePoint(newPoint.x-e.getX(), newPoint.y-e.getY());
				e.setSource(parent);
				parent.dispatchEvent(e);
			}
		}
		
	    public void mouseClicked(MouseEvent e)
	    {
	    	//System.out.println("mouseClicked() over " + getText());
	    	setSelected(!isSelected());
	    	((FlexiPlanning)JLesson.this.getParent()).setCurrentSelected(JLesson.this);
	    }
		
		
	}






	
	
}

