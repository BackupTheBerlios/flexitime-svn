/*
 * Created on 12 janv. 2005
 * by binou
 * Copyright: GPL - UMLV(FR) - 2004/2005
 */
package fr.umlv.ir3.flexitime.richClient.gui.panel.exploitation;

import java.awt.Color;
import java.awt.Container;
import java.awt.Dimension;
import java.awt.Font;
import java.awt.Point;

import java.awt.event.MouseEvent;


import javax.swing.BorderFactory;
import javax.swing.JLabel;
import javax.swing.SwingUtilities;
import javax.swing.event.MouseInputAdapter;





/**
 * A extended JLabel redefined to encapsulate and represent a Lesson
 * 
 * @version Verion ou révision SVN
 * 
 * @author FlexiTeam - binou
 */
public class JLesson extends JLabel
{
	/**
     * Comment for <code>serialVersionUID</code>
     */
    private static final long serialVersionUID = 3258411712125352247L;

    LessonBloc lesson = null;
    
    boolean isSelected = false;
    
    
    
    
    //**********************
    //	Constructeurs
    //**********************
    /**
     * creates a new JLesson
     */
    public JLesson()
    {
        this.lesson = null;
        
		MouseEventForwarder forwarder = new MouseEventForwarder();
		addMouseListener(forwarder);
		addMouseMotionListener(forwarder);
        
        this.setOpaque(true);
        this.setText("");
        this.setBackground(Color.WHITE);
        this.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
        this.setPreferredSize(new Dimension(FlexiPlanning.WEEK_WIDTH,FlexiPlanning.GAP_HEIGTH*1));
    }
    
    
    /**
     * Creates a new JLesson based on an other one
     * @param lesson
     */
    public JLesson(LessonBloc lesson)
    {
        this.lesson = lesson;

        MouseEventForwarder forwarder = new MouseEventForwarder();
        addMouseListener(forwarder);
        addMouseMotionListener(forwarder);

        this.setOpaque(true);
        this.setBackground(lesson.getLesson().getCourse().getColor());
        this.setBorder(BorderFactory.createLineBorder(Color.BLACK));
        this.setFont(new Font("Serif", Font.PLAIN, 9));
        this.setText("<html>" + lesson.getLesson().getCourse().getName() + " "
                + lesson.getLesson().getGap().getStartDate().getTime() + "/"
                + lesson.getLesson().getGap().getEndDate().getTime() + "</html>");
        this.setToolTipText("<html>" + lesson.getLesson().getCourse().getName() + "<br>"
                + lesson.getLesson().getGap().getStartDate().getTime() + "/"
                + lesson.getLesson().getGap().getEndDate().getTime()
                + "<br> blablabla </html>");
        this.setPreferredSize(new Dimension(FlexiPlanning.WEEK_WIDTH,
                FlexiPlanning.GAP_HEIGTH * lesson.getNbGap()));
    }

    
    
    /** 
     * Tells if the component is selected or not
     *
     * @return true if the component is selected
     * 
     */
    public boolean isSelected()
    { return isSelected;}
    
    /** 
     * Change the style of the component it's selected or not
     *
     * @param value 
     * 
     */
    public void setSelected(boolean value)
    {
        this.isSelected=value;
        if(value)
        {
            this.setBorder(BorderFactory.createLineBorder(Color.RED));
        }
        else
        {
            if(lesson == null)
                this.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
            else
                this.setBorder(BorderFactory.createLineBorder(Color.BLACK));
        }
    }
    
    /** 
     * Change the component style if there's a drag or not over it
     *
     * @param b 
     * 
     * @author   FlexiTeam - binou
     */
    public void setDragOver(boolean b)
    {
        //System.out.println("drag = " + b);
        if(b == true)
            this.setBackground(Color.GREEN);
        else
            this.setBackground(Color.WHITE);
    }
    
    
    

  
	/** 
	 * Should normally be in a model
	 *
	 * @return the lesson of the component
	 */
	public LessonBloc getLesson() {
		return lesson;
	}
	
	/** 
	 * Returns the gap's size of the component 
	 *
	 * @return the gap's size of the component 
	 * 
	 */
	public int getNbGaps()
	{
		if(lesson == null)
			return 1;
        
		return lesson.getNbGap();
	}
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	final class MouseEventForwarder extends MouseInputAdapter {
		/** 
		 * @see javax.swing.event.MouseInputAdapter#mousePressed(java.awt.event.MouseEvent)
		 * @author   FlexiTeam - binou
		 */
		public void mousePressed(MouseEvent e) {
	    	
	    	//forward
			Container parent = getParent();
			if (parent != null) {
				Point newPoint = SwingUtilities.convertPoint(JLesson.this, e.getPoint(), parent);
				e.translatePoint(newPoint.x-e.getX(), newPoint.y-e.getY());
				e.setSource(parent);
				parent.dispatchEvent(e);
			}
		}

		/** 
		 * @param e 
		 * 
		 * @see javax.swing.event.MouseInputAdapter#mouseReleased(java.awt.event.MouseEvent)
		 * @author   FlexiTeam - binou
		 */
		public void mouseReleased(MouseEvent e) {
			Container parent = getParent();
			if (parent != null) {
				Point newPoint = SwingUtilities.convertPoint(JLesson.this, e.getPoint(), parent);
				e.translatePoint(newPoint.x-e.getX(), newPoint.y-e.getY());
				e.setSource(parent);
				parent.dispatchEvent(e);			
			}
		}


		/** 
		 * @see javax.swing.event.MouseInputAdapter#mouseDragged(java.awt.event.MouseEvent)
		 * @author   FlexiTeam - binou
		 */
		public void mouseDragged(MouseEvent e) {
			Container parent = getParent();
			if (parent != null) {
				Point newPoint = SwingUtilities.convertPoint(JLesson.this, e.getPoint(), parent);
				e.translatePoint(newPoint.x-e.getX(), newPoint.y-e.getY());
				e.setSource(parent);
				parent.dispatchEvent(e);
			}
		}
		
	    /** 
	     * @see javax.swing.event.MouseInputAdapter#mouseClicked(java.awt.event.MouseEvent)
	     * @author   FlexiTeam - binou
	     */
	    public void mouseClicked(MouseEvent e)
	    {
            //c juste pour virer le warning :p
            e.getY();
	    	setSelected(!isSelected());
	    	((FlexiPlanning)JLesson.this.getParent()).setCurrentSelected(JLesson.this);
	    }
		
		
	}






	
	
}

