/*
 * Created on 4 janv. 2005
 * by binou
 * Copyright: GPL - UMLV(FR) - 2004/2005
 */

package fr.umlv.ir3.flexitime.richClient.gui.panel.exploitation;

import java.awt.Color;
import java.awt.Component;
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;
import java.awt.Point;
import java.awt.Rectangle;
import java.awt.image.BufferedImage;
import java.awt.dnd.DnDConstants;
import java.awt.dnd.DragSource;
import java.awt.dnd.DropTarget;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.awt.event.MouseMotionAdapter;
import java.awt.event.MouseMotionListener;
import java.util.ArrayList;
import java.util.List;
import javax.swing.JComponent;
import javax.swing.JMenu;
import javax.swing.JMenuItem;
import javax.swing.JPanel;
import javax.swing.JPopupMenu;
import javax.swing.SwingUtilities;

import fr.umlv.ir3.flexitime.common.gui.event.PlanningDataEvent;
import fr.umlv.ir3.flexitime.common.gui.event.PlanningDataListener;
import fr.umlv.ir3.flexitime.common.gui.models.RessourcePlanningModel;
import fr.umlv.ir3.flexitime.richClient.gui.panel.exploitation.controllers.ComponentDragGestureListener;
import fr.umlv.ir3.flexitime.richClient.gui.panel.exploitation.controllers.ComponentDragSourceListener;
import fr.umlv.ir3.flexitime.richClient.gui.panel.exploitation.controllers.ComponentDropTargetListener;
import fr.umlv.ir3.flexitime.richClient.gui.renderers.PlanningTrimCellHeaderRenderer;
import fr.umlv.ir3.flexitime.richClient.gui.renderers.PlanningTrimCellRenderer;

/**
 * A component that allows the user to manage a planning A separate model,
 * <code>EDTModel</code>, represents the contents of the planning.
 * 
 * @version 0.1
 * @see RessourcePlanningModel
 * @see PlanningTrimCellRenderer
 * @see PlanningTrimCellHeaderRenderer
 * @author FlexiTeam - binou
 */
public class JRessourcePlanning extends JPanel implements PlanningDataListener, KeyListener
{

    /**
     * Comment for <code>serialVersionUID</code>
     */
    private static final long              serialVersionUID = 3257283613144986167L;

    /**
     * Comment for <code>WEEK_WIDTH</code>
     */
    public static final int                WEEK_WIDTH       = 90;
    /**
     * Comment for <code>DAY_HEIGTH</code>
     */
    public static final int                DAY_HEIGTH       = 18;
    /**
     * Comment for <code>DAY_COLUMN_WIDTH</code>
     */
    public static final int                DAY_COLUMN_WIDTH = 75;

    /**
     * Comment for <code>GAP_HEIGTH</code>
     */
    public static int                      GAP_HEIGTH;

    // TODO changer les tailles pour les calculer suivant les parametres du
    // modele

    private GridBagLayout                  gbl;

    private DragSource                     dragSource;
    private DropTarget                     dropTarget;
    
    public static BufferedImage           buffImage        = null;                // buff image
    public static Point                   cursorPoint      = new Point();

    private List<JBusy>                    selectedItems;

    private RessourcePlanningModel         model;
    private PlanningTrimCellRenderer       cellRenderer;
    private PlanningTrimCellHeaderRenderer cellHeaderRenderer;
    

    protected DayPanel[][]  dayPanelTabs;
    protected JPanel[]    blocPanelTabs;
    
    protected JPopupMenu  popupSeance;
    protected JPopupMenu  popupVide;
    protected JMenuItem   menuItem;
    protected JMenu       menu;
    protected JMenu       menu2;
    protected JMenuItem   menuItem2;


    /**
     * Creates a new FlexiPlanning, using the specified model
     * 
     * @param model the model to reprensents the data
     */
    public JRessourcePlanning(RessourcePlanningModel model)
    {
        super();

        // this.gbl = new GridBagLayout();
        // setLayout(gbl);

        dragSource = new DragSource();
        ComponentDragSourceListener tdsl = new ComponentDragSourceListener();
        dragSource.createDefaultDragGestureRecognizer(this,
                DnDConstants.ACTION_COPY_OR_MOVE,
                new ComponentDragGestureListener(this, dragSource, tdsl));
        ComponentDropTargetListener tdtl = new ComponentDropTargetListener(this);
        dropTarget = new DropTarget(this, DnDConstants.ACTION_MOVE, tdtl);
        dropTarget.getClass();

        this.model = model;
        this.cellRenderer = new PlanningTrimCellRenderer();
        this.cellHeaderRenderer = new PlanningTrimCellHeaderRenderer();

        this.model.addPlanningDataListener(this);

        this.selectedItems = new ArrayList<JBusy>();

        this.init();
        this.setAutoscrolls(true);
        MouseMotionListener doScrollRectToVisible = new MouseMotionAdapter() {
            public void mouseDragged(MouseEvent e) {
                //System.out.println("mouseDragged at " + System.currentTimeMillis());
               Rectangle r = new Rectangle(e.getX(), e.getY(), 1, 1);
               ((JPanel)e.getSource()).scrollRectToVisible(r);
           }
            
        };
        this.addMouseMotionListener(doScrollRectToVisible);
        this.addKeyListener(this);
        
        createPopup();
        
    }
    

    

    //*************************************************
    //   getters
    //*************************************************

    /**
     * Returns the model of the FlexiEDT
     * 
     * @return the model used by the component
     * @see RessourcePlanningModel
     * @author FlexiTeam - binou
     */
    public RessourcePlanningModel getModel()
    {
        return model;
    }
    


    
    
    
 


    
    
    //*************************************************
    //   Création
    //*************************************************

    /**
     * Initialyse the time table Is only used at the creation
     * 
     * @author FlexiTeam - binou
     */
    private void init()
    {
        this.gbl = new GridBagLayout();
        setLayout(this.gbl);
        System.out.println("nbWeeks :" + model.getNbWeeks());
        dayPanelTabs = new DayPanel[model.getNbWeeks()][model.getNbDays()];
        for (int i = 0 ; i < model.getNbWeeks() ; i++)
            for (int j = 0 ; j < model.getNbDays() ; j++)
                dayPanelTabs[i][j] = new DayPanel(new GridBagLayout(), model.getDayGapSize());

        this.blocPanelTabs = new JPanel[model.getNbDays()];
        for (int i = 0 ; i < blocPanelTabs.length ; i++)
            blocPanelTabs[i] = new JPanel(new GridBagLayout());
        
        GAP_HEIGTH = model.getGapUnit() / 5 * model.getGapMultiplicateur();
        
        revalidate();
        removeAll();
        //TODO virer les header
        this.createWeekLign();
        this.createDayColumn();
        this.fillLesson();
        repaint();
    }

    /**
     * Generate the week Header of the time table containing the number of each
     * week
     * 
     * @author FlexiTeam - binou
     */
    private void createWeekLign()
    {
        for (int i = 0 ; i < model.getNbWeeks() ; i++)
            addWeekHeader(i + 1, 0, i); // +1 =+dayColumn
    }

    /**
     * Generate the first Column of the planning containing :<br>- the name of
     * each day - all gap's header - each date of each days on each weeks Is
     * only used at the creation
     * 
     * @author FlexiTeam - binou
     */
    private void createDayColumn()
    {
        int tempY;
        for (int i = 0 ; i < model.getNbDays() ; i++)
        {
            tempY = i * ( model.getDayGapSize() + 1 ) + 1; // dernier +1 =
                                                            // +weekLign
            addDayHeader(0, tempY, i);
            for (int j = 0 ; j < model.getNbWeeks() ; j++)
                addDateHeader(j + 1, tempY, j, i);
            int length;
            int cur = tempY + 1;
            int pointeur = 0;
            addBlocPanel(cur, i);
            for (int j = 0 ; j < model.getNbBloc() ; j++)
            {
                length = model.getBlocSize(j);
                addGapHeader(i , pointeur, j, length);
                cur += length;
                pointeur += length;
                
            }
        }
    }

    private void addBlocPanel(int y, int day)
    {
        GridBagConstraints c = new GridBagConstraints();
        c.gridx = 0;
        c.gridy = y;
        c.gridheight = model.getDayGapSize();
        c.anchor = GridBagConstraints.NORTH;

        //System.out.println("from " + y + "sur " + model.getDayGapSize());
        //System.out.println("ajout du panel en " + x + "," + y + " sur " + model.getDayGapSize() + " cases");
        add(this.blocPanelTabs[day], c);
    }

    /**
     * Generate the data in the planning : - each Lessons - each empty space (no
     * lessons) Is only used at the creation
     * 
     * @author FlexiTeam - binou
     */
    private void fillLesson()
    {
        int tempY;
        for (int k = 0 ; k < model.getNbWeeks() ; k++)
        {
            for (int i = 0 ; i < model.getNbDays() ; i++)
            {
                tempY = i * ( model.getDayGapSize() + 1 ) + 1;
                addPanel(k+1,tempY+1,k,i);
                for (int j = 0 ; j < model.getDayGapSize() ; j++)
                    //addEmptyLesson(k, tempY + j);
                    addGap(k + 1, ( tempY + 1 ) + j, k, i, j);
            }
        }
    }

    private void addPanel(int x, int y, int week, int day)
    {
        GridBagConstraints c = new GridBagConstraints();
        c.gridx = x;
        c.gridy = y;
        c.gridheight = model.getDayGapSize();
        //System.out.println("ajout du panel en " + x + "," + y + " sur " + model.getDayGapSize() + " cases");
        add(dayPanelTabs[week][day], c);
        
    }
    
    
    private void createPopup()
    {
        popupSeance = new JPopupMenu();
        menuItem = new JMenuItem("Couper");
        //menuItem.addActionListener(this);
        popupSeance.add(menuItem);
        menuItem = new JMenuItem("Copier");
        //menuItem.addActionListener(this);
        popupSeance.add(menuItem);
        menuItem = new JMenuItem("Coller");
        menuItem.setEnabled(false);
        //menuItem.addActionListener(this);
        popupSeance.add(menuItem);
        popupSeance.addSeparator();
        menuItem = new JMenuItem("Editer la séance");
        //menuItem.addActionListener(this);
        popupSeance.add(menuItem);
        menuItem = new JMenuItem("Envoyer un rappel au professeur");
        //menuItem.addActionListener(this);
        popupSeance.add(menuItem);
        menu = new JMenu("Dupliquer");
        //menuItem.addActionListener(this);
        {
            menu2 = new JMenu("sur n semaines");
            {
                menuItem = new JMenuItem("1");
                //menuItem.addActionListener(this);
                menu2.add(menuItem);
                menuItem = new JMenuItem("2");
                //menuItem.addActionListener(this);
                menu2.add(menuItem);
                menuItem = new JMenuItem("3");
                //menuItem.addActionListener(this);
                menu2.add(menuItem);
            }
            menu.add(menu2);
            menuItem = new JMenuItem("sur 1 mois");
            //menuItem.addActionListener(this);
            menu.add(menuItem);
        }
        
        popupSeance.add(menu);
        menuItem = new JMenuItem("Supprimer");
        //menuItem.addActionListener(this);
        popupSeance.add(menuItem);
        
        MouseListener popupListener = new PopupListener();
        this.addMouseListener(popupListener);
        
        
        popupVide = new JPopupMenu();
        menuItem = new JMenuItem("Couper");
        menuItem.setEnabled(false);
        //menuItem.addActionListener(this);
        popupVide.add(menuItem);
        menuItem = new JMenuItem("Copier");
        menuItem.setEnabled(false);
        //menuItem.addActionListener(this);
        popupVide.add(menuItem);
        menuItem = new JMenuItem("Coller");
        //menuItem.addActionListener(this);
        popupVide.add(menuItem);
        popupVide.addSeparator();
        menuItem = new JMenuItem("Ajouter une indisponibilité");
        //menuItem.addActionListener(this);
        popupVide.add(menuItem);
        
    }
    
    
    
    //*************************************************
    //   Ajout des données
    //*************************************************

    /**
     * Add to the layout a week header at the specified coordinate Is only used
     * at the creation
     * 
     * @param x the x coordinate
     * @param y the y coordinate
     * @param weekNumber the column number of the header to add
     * @author FlexiTeam - binou
     */
    private void addWeekHeader(int x, int y, int weekNumber)
    {
        JComponent comp = cellHeaderRenderer.getEDTCellHeaderRendererComponent(
                this, model.getWeekHeaderAt(weekNumber),
                PlanningTrimCellHeaderRenderer.WEEK_HEADER, 1);

        GridBagConstraints c = new GridBagConstraints();
        c.gridx = x;
        c.gridy = y;
        add(comp, c);
    }

    /**
     * Add to the layout a date header at the specified coordinate Is only used
     * at the creation
     * 
     * @param x the x coordinate
     * @param y the y coordinate
     * @param weekNumber the week number of the date to add
     * @param dayNumber the day number of the header to add
     * @author FlexiTeam - binou
     */
    private void addDateHeader(int x, int y, int weekNumber, int dayNumber)
    {
        JComponent comp = cellHeaderRenderer.getEDTCellHeaderRendererComponent(
                this, model.getDateHeaderAt(weekNumber, dayNumber),
                PlanningTrimCellHeaderRenderer.DATE_HEADER,1);

        GridBagConstraints c = new GridBagConstraints();
        c.gridx = x;
        c.gridy = y;
        add(comp, c);
    }

    /**
     * Add to the layout a gap header at the specified coordinate Is only used
     * at the creation
     * 
     * @param x the x coordinate
     * @param y the y coordinate
     * @param length
     * @param length2 
     * @param gapNumber the gap number of the header to add
     * @author FlexiTeam - binou
     */
    private void addGapHeader(int day, int gapNumber, int blocNumber, int length)
    {
        JComponent comp = cellHeaderRenderer.getEDTCellHeaderRendererComponent(this, model.getGapHeaderAt(blocNumber),
                PlanningTrimCellHeaderRenderer.GAP_HEADER, length);

        GridBagConstraints c = new GridBagConstraints();
        
        c.gridx = 0;
        c.gridy = gapNumber;
        c.gridheight = length;
        c.fill = GridBagConstraints.HORIZONTAL;
        this.blocPanelTabs[day].add(comp,c);
    }

    /**
     * Add to the layout a day header at the specified coordinate Is only used
     * at the creation
     * 
     * @param x the x coordinate
     * @param y the y coordinate
     * @param dayNumber - the day number of the header to add
     * @author FlexiTeam - binou
     */
    private void addDayHeader(int x, int y, int dayNumber)
    {
        JComponent comp = cellHeaderRenderer.getEDTCellHeaderRendererComponent(
                this, model.getDayHeaderAt(dayNumber),
                PlanningTrimCellHeaderRenderer.DAY_HEADER, dayNumber);

        GridBagConstraints c = new GridBagConstraints();
        c.gridx = x;
        c.gridy = y;
        add(comp, c);
    }

    /**
     * Quel service est rendu par cette méthode
     * <code>exemple d'appel de la methode</code>
     * 
     * @param weekNumber
     * @param dayNumber
     * @param gapNumber
     * @author FlexiTeam - binou
     */
    private void addGap(int x, int y, int weekNumber, int dayNumber,
            int gapNumber)
    {

        JComponent comp = cellRenderer.getEDTCellRendererComponent(this, model
                .getElementAt(weekNumber, dayNumber, gapNumber), weekNumber,
                dayNumber, gapNumber);
        
        if (comp != null)
        {
            GridBagConstraints c = new GridBagConstraints();
            c.gridx = 0;
            c.gridy = gapNumber;
            c.fill = GridBagConstraints.HORIZONTAL;
            if (comp instanceof JBusy)
            {
                JBusy jbusy = (JBusy)comp;
                if(jbusy.getBusy() != null)
                {
                    c.gridheight = ( (JBusy) comp ).getNbGaps();
                    c.anchor = GridBagConstraints.NORTH;
                }
                else
                {
                    c.anchor = GridBagConstraints.SOUTH;
                }
            }
            dayPanelTabs[weekNumber][dayNumber].add(comp,c);
        }
    }

    private void addGap(int weekNumber, int daynumber, int lowerGap)
    {
        addGap(weekNumber + 1, 1 + daynumber * ( model.getDayGapSize() + 1 )
                + lowerGap + 1, weekNumber, daynumber, lowerGap);
    }
    
    
    
    
    
    
    //*************************************************
    //   Manipulation
    //*************************************************
    

    /** 
     * Return the JBusy at the specified week, day and gap
     *
     * @param week
     * @param day
     * @param gap
     * @return a jbusy
     * 
     */
    public JBusy locateBusyAt(int week, int day, int gap)
    {
        return(this.dayPanelTabs[week][day].getBusyAt(gap));
        //return getComponentAt(weekToX(week), gapToY(day, gap));
    }
    
    /** 
     * Return the JBusy at the specified system coordinate
     * 
     * @param p 
     * @return a jbusy
     * 
     */
    public JBusy getBusyAt(Point p)
    {
        Component comp = getComponentAt(p);

        if ( comp instanceof DayPanel )
        {
            Point newP = SwingUtilities.convertPoint(this, p, comp);
            comp = ( (DayPanel) comp ).getComponentAt(newP);
            if(comp instanceof JBusy)
                return (JBusy)comp;
        System.err.println("no busy for getBusyAt(" + p.x + "," + p.y + ")");
            return null;
        }
        return null;  
    }
    
    /** 
     * Return the JBusy at the specified system coordinate
     * @param x 
     * @param y 
     * 
     * @return a jbusy
     * 
     */
    public JBusy getBusyAt(int x, int y)
    {
        return getBusyAt(new Point(x,y));
    }
    
    
    /** 
     * Returns the week number for the specified system coordinate
     *
     * @param p system coordinate
     * @return the week number
     * 
     */
    public int locateWeek(Point p)
    {
        if(!isALessonGap(p))
            return -1;
        return gbl.location(p.x, p.y).x - 1;
    }
    
    /** 
     * Returns the week number for the specified system coordinate
     *
     * @param p system coordinate
     * @return the week number
     * 
     */
    public int locateDay(Point p)
    {
        if(!isALessonGap(p))
            return -1;
        
        return (  gbl.location(p.x, p.y).y - 2 ) / ( model.getDayGapSize() + 1 );
    }
    
    /** 
     * Returns the week number for the specified system coordinate
     *
     * @param p system coordinate
     * @return the week number
     * 
     */
    public int locateGap(Point p)
    {
        Component comp = getComponentAt(p);
        if(comp instanceof DayPanel)
        {
            Point newP = SwingUtilities.convertPoint(this,p, comp);
            JBusy busy = (JBusy)( (DayPanel) comp ).getComponentAt(newP);
            GridBagConstraints c = ((GridBagLayout)  ((DayPanel)comp).getLayout()).getConstraints(busy);
            return c.gridy   ;
        }
        return -1;
    }
    
    
    /**
     * return true if the specified system cordinate is a lesson gap
     * 
     * @param p the datagrid point
     * @return true if its a lesson gap
     * @author FlexiTeam - binou
     */
    public boolean isALessonGap(Point p)
    {
        Point p_rel = this.gbl.location(p.x,p.y);

        if (p_rel.x > model.getNbWeeks()) return false;
        return ! ( p_rel.x <= 0 || p_rel.y <= 1 || ( p_rel.y - 1 )
                % ( model.getDayGapSize() + 1 ) == 0 );
    }
    


    
    
    
    
    //*************************************************
    //   Sélection
    //*************************************************

    
    /**
     * Sets the current Component selected in the planning
     * 
     * @param currentSelected
     * @param ctrl
     */
    public void setCurrentSelected(JBusy currentSelected, boolean ctrl)
    {
        if (ctrl)
        {
            if (!selectedItems.remove(currentSelected))
            {
                selectedItems.add(currentSelected);
                currentSelected.setSelected(true);
            }
            else
                currentSelected.setSelected(false);
        }
        else
        {
            for (JBusy busy : selectedItems)
            {
                busy.setSelected(false);
            }
            selectedItems.clear();
            selectedItems.add(currentSelected);
            currentSelected.setSelected(true);
        }

    }
    
    /** 
     * DOCME Description
     * Quel service est rendu par cette méthode
     * <code>exemple d'appel de la methode</code>
     *
     * @param busyAt
     * @return 
     * 
     * @see (si nécessaire)
     */
    public boolean isSelected(JBusy busyAt)
    {
        return this.selectedItems.contains(busyAt);
    }
    
    /**
     * Change the style of a gap in (x,y) and the followings, when there's a
     * drag over them
     * 
     * @param x
     * @param y
     * @param value 
     * @author FlexiTeam - binou
     */
    public void setDragOverStyle(int x, int y, boolean value)
    {
        //getComponentAt(xToWeek(x), yToDay(y),yToGapInTheDay(y)).setDragOver(value);
    }
    
    
    
    
    
    
    //*************************************************
    //   Listeners
    //*************************************************

    /**
     * Sent after the indices in the lowerGap,upperGap interval have been
     * inserted in the data model. The new interval includes both lowerGap and
     * upperGap.
     * 
     * @param e a <code>PlanningDataEvent</code> encapsulating the event
     *        information
     */
    public void intervalAdded(PlanningDataEvent e)
    {
        //System.out.println("intervalAdded() de " + e.getLowerGap()); //$NON-NLS-1$
        //System.out.println(e.getUpperGap());

        this.dayPanelTabs[e.getWeekNumber()][e.getDaynumber()].removeInterval(e.getLowerGap() , e.getUpperGap());

        //repaint();
        //revalidate();
        for (int i = e.getLowerGap() ; i <= e.getUpperGap() ; i++)
            addGap(e.getWeekNumber(), e.getDaynumber(), i);

        // System.out.println(model.getDayGapSize() + "*" +e.getDaynumber()+ "*"
        // + GAP_HEIGTH + "+" +DAY_HEIGTH+ "*" +(e.getDaynumber()+1)+"+"+
        // GAP_HEIGTH + "*" + e.getLowerGap() + "+ 2" );
        // System.out.println(x + " - " + y);
    }

    /**
     * Sent after the indices in the lowerGap,upperGap interval have been
     * removed from the data model. The interval includes both lowerGap and
     * upperGap.
     * 
     * @param e a <code>PlanningDataEvent</code> encapsulating the event
     *        information
     */
    public void intervalRemoved(PlanningDataEvent e)
    {
        e.getClass();
    }

    /**
     * Sent when the contents of the list has changed in a way that's too
     * complex to characterize with the previous methods. For example, this is
     * sent when an item has been replaced. lowerGap and upperGap bracket the
     * change.
     * 
     * @param e a <code>PlanningDataEvent</code> encapsulating the event
     *        information
     */
    public void contentsChanged(PlanningDataEvent e)
    {
        System.out.println("contentsChanged()");
        locateBusyAt(e.getWeekNumber(), e.getDaynumber(),e.getLowerGap()).refresh();
        
        e.getClass();
    }
    
    
    
    
    
    //*************************************************
    //   Navigation
    //*************************************************
    
    
    /**
     * Change the range of week currently used for the planning <br>
     * the result will be the previous Gap of week
     */
    public void fullStepBack()
    {
        model.fullStepBack();
        this.init();
    }

    /**
     * Change the range of week currently used for the planning <br>
     * the result will be the same gap but one week earlier
     */
    public void stepBack()
    {
        model.stepBack();
        this.init();
    }

    /**
     * Change the range of week currently used for the planning <br>
     * the result will be the the same gap without the ending week
     */
    public void decrease()
    {
        model.decrease();
        this.init();
    }

    /**
     * Change the range of week currently used for the planning <br>
     * the result will be the the same gap with another week added
     */
    public void increase()
    {
        model.increase();
        this.init();
    }

    /**
     * Change the range of week currently used for the planning <br>
     * the result will be the same gap but one week later
     */
    public void stepOver()
    {
        model.stepOver();
        this.init();
    }

    /**
     * Change the range of week currently used for the planning <br>
     * the result will be the next Gap of week
     */
    public void fullStepOver()
    {
        model.fullStepOver();
        this.init();
    }

    /**
     * Decrease the size of gap's time
     */
    public void lessGapTime()
    {
        model.lessGapTime();
        this.init();
    }

    /**
     * Increase the size of gap's time
     */
    public void moreGapTime()
    {
        model.moreGapTime();
        this.init();
    }
    
    
    //*************************************************
    //   Classes internes
    //*************************************************

    class PopupListener extends MouseAdapter {
        public void mousePressed(MouseEvent e) {
            maybeShowPopup(e);
        }

        public void mouseReleased(MouseEvent e) {
            maybeShowPopup(e);
        }

        private void maybeShowPopup(MouseEvent e) {
            if (e.isPopupTrigger()  && isALessonGap(e.getPoint())  )
            {
                if(getModel().isALesson(locateWeek(e.getPoint()),locateDay(e.getPoint()),locateGap(e.getPoint())))
                    popupSeance.show(e.getComponent(),e.getX(), e.getY());
                else
                    popupVide.show(e.getComponent(),e.getX(), e.getY());
                if(! JRessourcePlanning.this.isSelected(getBusyAt(e.getPoint())))
                    JRessourcePlanning.this.setCurrentSelected(getBusyAt(e.getPoint()),false);
            }
        }
    }


    
    
    
    
    /** 
     * DOCME Description
     * Quel service est rendu par cette méthode
     * <code>exemple d'appel de la methode</code>
     *
     * @param e 
     * 
     * @see java.awt.event.KeyListener#keyTyped(java.awt.event.KeyEvent)
     * @author   FlexiTeam - binou
     */
    public void keyTyped(KeyEvent e){
        
    }









    /** 
     * DOCME Description
     * Quel service est rendu par cette méthode
     * <code>exemple d'appel de la methode</code>
     *
     * @param e 
     * 
     * @see java.awt.event.KeyListener#keyPressed(java.awt.event.KeyEvent)
     * @author   FlexiTeam - binou
     */
    public void keyPressed(KeyEvent e)
    {
        System.out.println(e.getKeyCode());
    }




    /** 
     * DOCME Description
     * Quel service est rendu par cette méthode
     * <code>exemple d'appel de la methode</code>
     *
     * @param e 
     * 
     * @see java.awt.event.KeyListener#keyReleased(java.awt.event.KeyEvent)
     * @author   FlexiTeam - binou
     */
    public void keyReleased(KeyEvent e){}
    

    

}
